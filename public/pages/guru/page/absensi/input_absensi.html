<template>
  <div class="page page-homepage light" data-name="homepage">
    <div class="navbar">
      <div class="navbar-inner">
        <div class="left">
          <a href="#" class="back">
            <i class="icon icon-back mr-3 ml-3"></i>
            <span class="if-not-md">Back</span>
          </a>
        </div>
        <div class="title" style="margin-left:-10px;">Absensi</div>
        <div class="right">
          <a class="ml-3" href="/input_absensi/" @click="openAlert" style="padding-right: 15px;">
            <i class="icon material-icons">save</i>
          </a>
          <div class="accordion-item-toggle">
            <a href="#" id="testinput" style="padding-right: 0px;">
              <i class="icon material-icons">tune</i>
            </a>
          </div>
          <a class="popover-open mr-2" data-popover=".popover-menu-laporan" style="padding-left: 10px;">
            <i class="icon material-icons">more_vert</i>
          </a>
        </div>
      </div>
    </div>
    <div class="fab fab-extended fab-right-bottom">
      <a href="/input_absensi/" @click="openAlert" class="bg-template">
        <i class="icon material-icons text-color-white">save</i>
      </a>
    </div>
    <div class="page-content ptr-content" data-ptr-mousewheel="false" @ptr:pullstart="start" @ptr:refresh="ptr">
      <div class="ptr-preloader" id="ptr3" style="display: none;">
        <div class="preloader"></div>
        <div class="ptr-arrow"></div>
      </div>
      <!-- Awal Filter -->
      <div class="accordion-item accorinput accordion-item-opened">
        <div class="accordion-item-content">
          <div class="list no-hairlines-md">
            <div class="block mt-0">
              <div class="card mb-2 mt-0">
                <div class="card-content card-content-padding">
                  <div class="list no-hairlines-md">
                    <ul>
                      <li>
                        <a class="item-link smart-select smart-select-init" data-open-in="popup"
                          data-page-title="Pilih Sekolah" data-searchbar="true"
                          data-searchbar-placeholder="Cari Sekolah">
                          <select name="sekolah" @change="filterAktif" id="sekolah">
                            <option value="SMK Telkom Malang" selected>SMK Telkom Malang</option>
                            <option value="SMK Brantas">SMK Brantas</option>
                          </select>
                          <div class="item-content">
                            <div class="item-media">
                              <figure class="avatar avatar-30 no-shadow"><i class="material-icons">account_balance</i>
                              </figure>
                            </div>
                            <div class="item-inner">
                              <div class="item-title">Sekolah</div>
                            </div>
                          </div>
                        </a>
                      </li>
                      <li>
                        <a class="item-link smart-select smart-select-init" data-open-in="popup"
                          data-page-title="Pilih Kelas" data-searchbar="true" data-searchbar-placeholder="Cari kelas">
                          <select name="kelas" @change="filterAktif" id="kelas">
                            <option value="XII RPL 1" selected>XII RPL 1 (0909)</option>
                            <option value="XII RPL 2">XII RPL 2 (0908)</option>
                            <option value="XII RPL 3">XII RPL 3 (0907)</option>
                            <option value="XII RPL 4">XII RPL 4 (0906)</option>
                            <option value="XII RPL 5">XII RPL 5 (0905)</option>
                            <option value="XII RPL 6">XII RPL 6 (0904)</option>
                            <option value="XII RPL 7">XII RPL 7 (0903)</option>
                          </select>
                          <div class="item-content">
                            <div class="item-media">
                              <figure class="avatar avatar-30 no-shadow"><i class="material-icons">class</i></figure>
                            </div>
                            <div class="item-inner">
                              <div class="item-title">Kelas</div>
                            </div>
                          </div>
                        </a>
                      </li>
                      <li>
                        <a class="item-link smart-select smart-select-init" data-open-in="popup"
                          data-page-title="Pilih Kategori" data-searchbar="true"
                          data-searchbar-placeholder="Cari Kategori">
                          <select name="sekolah" id="kategori">
                            <option value="Harian" selected>Harian</option>
                            <option value="Matematika">Matematika</option>
                            <option value="IPA">IPA</option>
                            <option value="IPS">IPS</option>
                            <option value="PKN">PKN</option>
                            <option value="Bahasa Indonesia">Bahasa Indonesia</option>
                          </select>
                          <div class="item-content">
                            <div class="item-media">
                              <figure class="avatar avatar-30 no-shadow"><i class="material-icons">view_module</i>
                              </figure>
                            </div>
                            <div class="item-inner">
                              <div class="item-title">Kategori</div>
                            </div>
                          </div>
                        </a>
                      </li>
                      </li>
                      <li class="item-content item-input mb-0" style="height: 50px;">
                        <div class="item-media">
                          <figure class="avatar avatar-30 no-shadow"><a><i class="material-icons">today</i></a></figure>
                        </div>
                        <div class="item-inner border-bottom">
                          <div class="absen-harian-toolbar no-shadow"
                            style="background-color: transparent; z-index: 2;">

                            <div class="toolbar-inner no-shadow" style="background-color: transparent;">
                              <div class="left text-color-black output-cal" id="demo-calendar-laporanAbsensi"></div>
                              <!-- <input style="width: 180px;" type="text" class="left text-color-black " placeholder="Your birth date"
                                readonly="readonly" id="demo-calendar-laporanAbsensi" /> -->
                              <div class="right">
                                <a href="#" class="link icon-only mr-1 btn-left"><i
                                    class="fas fa-arrow-left text-color-black" style="font-size: 15px;"></i></a>
                                <a href="#" id="btn-kanan1" class="link icon-only mr-3 ml-1 btn-right"><i
                                    class="fas fa-arrow-right " style="font-size: 15px;"></i></a>
                              </div>
                            </div>
                          </div>
                        </div>
                      </li>
                      <li class="item-content item-input">
                        <div class="item-media">
                          <figure class="avatar avatar-30 no-shadow"><a><i class="material-icons">note</i></a></figure>
                        </div>
                        <div class="item-inner">
                          <div class="item-input-wrap">
                            <textarea class="resizable" placeholder="Masukkan catatan" id="catatan"></textarea>
                          </div>
                        </div>
                      </li>
                      <li class="item-content item-input">
                        <div class="item-media">
                          <figure class="avatar avatar-30 no-shadow"><a><i class="material-icons">folder</i></a>
                          </figure>
                        </div>
                        <div class="item-inner">
                          <div class="item-input-wrap">
                            <input type="file" id="ok" name="ok" label="Pilih file" />
                            <input type="file" id="XXX" name="XXX" style="display:contents" label="Pilih file" />
                          </div>
                        </div>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Akhir Filter -->
      <!-- Awal Table -->

      <div class="data-table">
        <table width="100%">
          <thead>
            <tr>
              <th class="label-cell nama">Nama</th>
              <th class="label-cell absensi"> Absensi</th>
              <th class="ket label-cell"> Keterangan</th>
            </tr>
          </thead>
          <tbody>
            {{#if loading1}}
            <tr>
              <td class="nama label-cell skeleton-text">Muhammad Rafly Amartharizqi</td>
              <td class="absensi label-cell skeleton-text">Hehehehe</td>
              <td class="ket label-cell skeleton-text">POPOPOPOPOPOPOPO</td>
            </tr>
            <tr>
              <td class="nama label-cell skeleton-text">Muhammad Rafly Amartharizqi</td>
              <td class="absensi label-cell skeleton-text">Hehehehe</td>
              <td class="ket label-cell skeleton-text">POPOPOPOPOPOPOPO</td>
            </tr>
            <tr>
              <td class="nama label-cell skeleton-text">Muhammad Rafly Amartharizqi</td>
              <td class="absensi label-cell skeleton-text">Hehehehe</td>
              <td class="ket label-cell skeleton-text">POPOPOPOPOPOPOPO</td>
            </tr>
            {{else}}
            {{#isiAbsensi}}
            <tr>
              <td class="nama label-cell sheet-open" data-sheet=".demo-sheet-swipe-to-close"><a>{{nama}}</a></td>
              <td class="absensi label-cell">
                <a class="item-link smart-select smart-select-init" data-open-in="sheet">
                  <select name="absensi" id="absensi{{id}}" @change="Ganti">
                    <option value="H">Hadir</option>
                    <option value="S">Sakit</option>
                    <option value="I">Izin</option>
                    <option value="A">Alpa</option>
                  </select>
                  <div class="item-content">
                    <div class="item-inner">
                      <button class="button button-small button-fill item-after color-green" style="width: 100%;"
                        id="tombol{{id}}"></button>
                    </div>
                  </div>
                </a>
              </td>
              <td class="ket label-cell">
                <div class="input mt-2">
                  <textarea class="ket resizable" type="text"></textarea>
                </div>
              </td>
            </tr>
            {{/isiAbsensi}}
            {{/if}}
          </tbody>
        </table>
        <br><br>
      </div>
      <!-- Akhir Tabel -->
    </div>
    <div class="popover popover-menu-laporan">
      <div class="popover-angle"></div>
      <div class="popover-inner">
        <div class="list">
          <ul>
            <li><a href="/input_absensi/" class="list-button popover-close">Input Siswa</a></li>
            <li><a href="/laporan_absensi/" class="list-button popover-close">Laporan Absensi</a></li>
            <li><a href="/laporan_persiswa/" class="list-button popover-close">Laporan Absensi Per Siswa</a></li>
            <li><a href="/laporan_perbulan/" class="list-button popover-close">Laporan Absensi Per Bulan</a></li>
          </ul>
        </div>
      </div>
    </div>
    <div class="sheet-modal demo-sheet-swipe-to-close" style="max-height:90%; height: auto;">
      <div class="sheet-modal-inner">
        <div class="swipe-handler"></div>
        <div class="page-content">
          <div class="block text-align-center" style="background-color: cornsilk; padding: 10px;">
            <h5 class="mb-3">Muhammad Rafly Amartharizqi</h5>
          </div>
          <div class="list">
            <ul>
              <li>
                <div class="item-content">
                  <div class="item-media"><i class="material-icons vm text-template">person</i></div>
                  <div class="item-inner">
                    <div class="item-title">Nama Panggilan</div>
                    <div class="item-after" id="hari">Rafly</div>
                  </div>
                </div>
              </li>
              <li>
                <div class="item-content">
                  <div class="item-media"><i class="material-icons vm text-template">wc</i></div>
                  <div class="item-inner">
                    <div class="item-title">Jenis Kelamin</div>
                    <div class="item-after">Laki-laki</div>
                  </div>
                </div>
              </li>
              <li>
                <div class="item-content">
                  <div class="item-media"><i class="material-icons vm text-template">class</i></div>
                  <div class="item-inner">
                    <div class="item-title">Kelas</div>
                    <div class="item-after">X RPL 1</div>
                  </div>
                </div>
              </li>
              <li>
                <div class="item-content">
                  <div class="item-media"><i class="material-icons vm text-template">home</i></div>
                  <div class="item-inner input-wrap">
                    <div class="item-title">Alamat</div>
                  </div>
                </div>
              </li>
              <li>
                <div class="item-content">
                  <div class="item-media"><i class="material-icons vm text-template"></i></div>
                  <div class="item-inner">
                    <div class="item-title">Kecamatan</div>
                    <div class="item-after">Sidoarjo</div>
                  </div>
                </div>
              </li>
              <li>
                <div class="item-content">
                  <div class="item-media"><i class="material-icons vm text-template"></i></div>
                  <div class="item-inner">
                    <div class="item-title">Kelurahan</div>
                    <div class="item-after">Bligo</div>
                  </div>
                </div>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>
<style>
  li .item-content {
    height: 10px;
  }

  .smart-select-page .page-content .list .item-radio .item-inner {
    margin-left: -18px;
  }

  .smart-select-page .page-content .list {
    margin-top: 0px;
  }

  span.searchbar-disable-button::after {
    margin-top: -20px;
  }

  th.nama {
    padding-left: 15px;
  }

  td.nama {
    min-width: 220px;
    padding-right: 0px;
    padding-left: 17px;
  }

  td.absensi .button {
    min-width: 55px;
    padding: 0px;
  }

  th.absensi {
    padding-right: 0px;
    padding-left: 0px;
  }

  td.absensi {
    padding-right: 0px;
    padding-left: 0px;
  }

  td {
    cursor: pointer;
  }

  th.ket {
    padding-left: 10px;
  }

  td.ket {
    min-width: 100px;
    padding-right: 15px;
    padding-left: 10px;
  }

  td.ket .input textarea {
    background-color: rgb(233, 231, 231);
    min-width: 100px;
  }

  tr:nth-child(even) {
    background-color: rgb(240, 240, 250);
  }
</style>
<script>
  var dates = new Date();
  var tahun = dates.getFullYear();
  var bulan = dates.getMonth();
  var tgl = dates.getDate();
  var date = new Date(tahun, bulan, tgl);
  var monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun', 'Jul', 'Ags', 'Sept', 'Okt',
    'Nov', 'Des'
  ];
  monthNames1 = [
    'Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 'Juli', 'Agustus', 'September', 'Oktober',
    'November', 'Desember'
  ];
  var pilihTgl = date.getDate();
  var pilihBulan = date.getMonth();
  var pilihTahun = date.getFullYear();

  return {
    data: function () {
      return {
        isiAbsensi: [{
            id: 1,
            nama: "Muhammad Rafly Amartharizqi",
            jk: "Laki-laki",
            kelas: "XIIR3",
            alamat: ["candi", "bligo"],
            absensi: "Hadir",
            keterangan: "",
          },
          {
            id: 2,
            nama: "Abimanyu",
            jk: "Laki-laki",
            kelas: "XIIR3",
            alamat: ["candi", "bligo"],
            absensi: "Hadir",
            keterangan: "",
          },
          {
            id: 3,
            nama: "Alif Rayhan",
            jk: "Laki-laki",
            kelas: "XIIR3",
            alamat: ["candi", "bligo"],
            absensi: "Hadir",
            keterangan: "",
          },
          {
            id: 4,
            nama: "Sukemi",
            jk: "Laki-laki",
            kelas: "XIIR3",
            alamat: ["candi", "bligo"],
            absensi: "Hadir",
            keterangan: "",
          }
        ],
      }
    },
    methods: {
      openAlert: function () {
        var app = this.$app;
        var sekolah = document.getElementById('sekolah').value;
        var kelas = document.getElementById('kelas').value;
        var kategori = document.getElementById('kategori').value;
        var tanggal = document.getElementById('demo-calendar-laporanAbsensi').innerHTML;
        var catatan = document.getElementById('catatan').value;
        var hadir = this.isiAbsensi.filter((h) => h.absensi === "Hadir").length;
        var sakit = this.isiAbsensi.filter((s) => s.absensi === "Sakit").length;
        var izin = this.isiAbsensi.filter((i) => i.absensi === "Izin").length;
        var alpa = this.isiAbsensi.filter((a) => a.absensi === "Alpa").length
        app.dialog.confirm('Sekolah :' + sekolah + ' <br> Kelas : ' + kelas +
          ' <br> Kategori : ' + kategori +
          ' <br> Tanggal : ' + tanggal + '  <br> Catatan :' + catatan + ' <br> Hadir : ' + hadir +
          '<br> Sakit : ' + sakit +
          '<br> Izin : ' + izin + '<br> Alpa : ' + alpa, 'Data Sudah Benar?', );
      },

      showToastBottom: function () {
        var self = this;
        // Create toast
        if (!self.toastBottom) {
          self.toastBottom = self.$app.toast.create({
            text: 'Absensi telah disimpan',
            closeTimeout: 2000,
          });
        }
        // Open it
        self.toastBottom.open();
      },

      filterAktif: function () {
        var self = this;
        self.$setState({
          loading1: true
        });
        setTimeout(function () {
          self.$setState({
            loading1: false
          });
        }, 1000);
      },
      ptr: function (e, done) {
        var self = this;
        var $ = self.$$;
        self.$setState({
          loading1: true
        });
        setTimeout(function () {
          self.$setState({
            loading1: false
          });
          $("#ptr3").hide();
        }, 1000); // refresh done

        setTimeout(function () {
          self.$setState({
            items: self.items,
          });
          // Done
          done();
        }, 600);
        this.Halaman;
      },
      start: function () {
        $("#ptr3").show();
      },
      renderEvents: function () {
        var currentDate = date;
        var self = this;
        var sekarang1 = new Date();
        self.$setState({
          loading2: true
        });
        if (sekarang1.getDate() === pilihTgl && sekarang1.getMonth() === pilihBulan && sekarang1
          .getFullYear() === pilihTahun) {
          $('#btn-kanan1').addClass('text-color-gray disabled');
          $('#btn-kanan1').removeClass('text-color-black');
        } else if (pilihTgl >= sekarang1.getDate() && sekarang1.getMonth() === pilihBulan && sekarang1
          .getFullYear() === pilihTahun) {
          $('#btn-kanan1').addClass('text-color-gray disabled');
          $('#btn-kanan1').removeClass('text-color-black');
        } else {
          $('#btn-kanan1').removeClass('text-color-gray disabled');
          $('#btn-kanan1').addClass('text-color-black');
        }
        setTimeout(function () {
          self.$setState({
            loading2: false
          });
        }, 600);
      },
      Halaman: function () {
        var self = this;
        var app = self.$app;
        var $ = self.$;
        var acc = true;
        kunci = 9;

        setTimeout(function () {
          self.$setState({
            loading1: false
          });
        }, 1000);

        $('#testinput').on('click', function () {
          if (acc == true) {
            acc = false;
            app.accordion.close('.accorinput');
          } else {
            acc = true;
            app.accordion.open('.accorinput');
          };
        });

      },
      toggleSwipeStep: function () {
        var self = this;
        self.sheetSwipeToStep.stepToggle();
      },
      createSheet: function () {
        var self = this;
        // Create sheet modal
        if (!self.sheet) {
          self.sheet = self.$app.sheet.create({
            content: '\
            <div class="sheet-modal">\
              <div class="toolbar">\
                <div class="toolbar-inner justify-content-flex-end">\
                  <a href="#" class="link sheet-close">Close</a>\
                </div>\
              </div>\
              <div class="sheet-modal-inner">\
                <div class="page-content">\
                  <div class="block">\
                    <p>This sheet modal was created dynamically</p>\
                    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Suspendisse faucibus mauris leo, eu bibendum neque congue non. Ut leo mauris, eleifend eu commodo a, egestas ac urna. Maecenas in lacus faucibus, viverra ipsum pulvinar, molestie arcu. Etiam lacinia venenatis dignissim. Suspendisse non nisl semper tellus malesuada suscipit eu et eros. Nulla eu enim quis quam elementum vulputate. Mauris ornare consequat nunc viverra pellentesque. Aenean semper eu massa sit amet aliquam. Integer et neque sed libero mollis elementum at vitae ligula. Vestibulum pharetra sed libero sed porttitor. Suspendisse a faucibus lectus.</p>\
                  </div>\
                </div>\
              </div>\
            </div>\
          '
          });
        }
        // Close inline sheet
        if (self.$('.demo-sheet.modal-in').length > 0) self.$app.sheet.close('.demo-sheet');
        // Open it
        self.sheet.open();
      },
      Ganti: function () {
        this.isiAbsensi.forEach(function (a) {
          var absensi1 = document.getElementById("absensi" + a.id).value;
          var tombol = document.getElementById('tombol' + a.id);
          if (absensi1 == "H") {
            tombol.className = 'button button-small button-fill item-after color-green';
            a.absensi = 'Hadir'
          } else if (absensi1 == "S") {
            tombol.className = 'button button-small button-fill item-after color-blue';
            a.absensi = 'Sakit'
          } else if (absensi1 == "I") {
            tombol.className = 'button button-small button-fill item-after color-orange';
            a.absensi = 'Izin'
          } else if (absensi1 == "A") {
            tombol.className = 'button button-small button-fill item-after color-red';
            a.absensi = 'Alpa'
          }
        });
      },
    },
    on: {
      pageInit: function (e, page) {
        var self = this;
        var today = new Date();
        var app = self.$app;
        var $ = self.$;

        if (self.loading1) return;
        self.$setState({
          loading1: true,
        });
        setTimeout(function () {
          self.$setState({
            loading1: false
          });
        }, 1000);
        self.renderEvents();
        $('.absen-harian-toolbar .left').text(pilihTgl + ' ' + monthNames[pilihBulan] + ' ' + pilihTahun);
        self.renderEvents();
        $('.absen-harian-toolbar .right .btn-left').on('click', function () {
          var t = date.setDate(pilihTgl - 1);
          pilihTgl = date.getDate(t);
          calendarDefault.setValue([new Date('' + pilihTahun + '/' + monthNames[pilihBulan] + '/' + pilihTgl +
            '')]);
          $('.absen-harian-toolbar .left').text(pilihTgl + ' ' + monthNames[pilihBulan] + ' ' + pilihTahun);
          self.renderEvents();
        });
        $('.absen-harian-toolbar .right .btn-right').on('click', function () {
          var b = date.setDate(pilihTgl + 1);
          pilihTgl = date.getDate(b);
          calendarDefault.setValue([new Date('' + pilihTahun + '/' + monthNames[pilihBulan] + '/' + pilihTgl +
            '')]);
          $('.absen-harian-toolbar .left').text(pilihTgl + ' ' + monthNames[pilihBulan] + ' ' + pilihTahun);
          self.renderEvents();
        });

        // Default
        var calendarDefault = app.calendar.create({
          inputEl: '#demo-calendar-laporanAbsensi',
          dateFormat: 'd MM yyyy',
          value: [Date(pilihTahun, pilihBulan, pilihTgl)],
          closeOnSelect: true,
          disabled: {
            from: today
          },
          monthNames: [
            'Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 'Juli', 'Agustus', 'September', 'Oktober',
            'November', 'Desember'
          ],
          monthNamesShort: [
            'Jan', 'Feb', 'Mac', 'Apr', 'Mei', 'Jun', 'Jul', 'Ogo', 'Sep', 'Okt', 'Nov', 'Dis'
          ],
          dayNames: [
            'Ahad', 'Isnin', 'Selasa', 'Rabu', 'Khamis', 'Jumaat', 'Sabtu'
          ],
          dayNamesShort: [
            'Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'
          ],
          on: {
            dayClick(calendar, dayEl, year, month, day, monthNamesShort) {
              pilihTgl = day;
              pilihBulan = month;
              pilihTahun = year;
              $('.output-cal').text(pilihTgl + ' ' + monthNames[pilihBulan] + ' ' + pilihTahun)
              self.$setState({
                pilihTgl: day,
                pilihBulan: month,
                pilihTahun: year
              });
            },
            monthYearChangeStart: function () {
              $('.output-cal').text(pilihTgl + ' ' + monthNames[pilihBulan] + ' ' + pilihTahun)
            }
          },
        });
        self.sheetSwipeToClose = self.$app.sheet.create({
          el: '.demo-sheet-swipe-to-close',
          swipeToClose: true,
          push: true,
          backdrop: true,
        });

        self.Halaman();
        // Default


      },
      pageBeforeOut: function () {
        var self = this;
        self.$app.toast.close();
        // Close opened sheets on page out
        self.$app.sheet.close();
      },
      pageBeforeRemove() {
        var self = this;
        // calendarDefault.destroy();
        if (self.toastBottom) self.toastBottom.destroy();
        if (self.sheetSwipeToClose) self.sheetSwipeToClose.destroy();
      },

    },
  }
</script>